---
title: "For Loops"
author: "Matthew Whittle"
date: "11/01/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Agenda

-   What is a for loop?

-   How to write one?

-   Potential uses

-   Alternatives

# What is a 'For Loop'?

-   Iteration: the repetition of a process. Important concept in computer programming

-   For loop is way to iterate through a sequence - repeating a set of instructions for every input. Very useful ability in analysis & programming

-   The loop is run *for* a certain number of repetitions

-   Useful tool, but not always the best for a job

-   There are a few alternatives to for loops: vectorized code, iteration using map functions (e.g. `lapply`, `purrr::map`, etc.)

# Writing a for loop

Imagine we have a list of names, and for each we want to print out a message for each. Without using a for loop we could do this by repeating the code for each name.

```{r}
print("Hi Olivia!")
print("Hi Liam!")
print("Hi Emma!")
print("Hi Noah!")
print("Hi Amelia!")
print("Hi Oliver!")
```

With a for loop we can reduce this into a few lines of code with much less repetition.

```{r}
# Store the top 6 baby names in a vector named baby_names
baby_names <- c("Olivia", "Liam", "Emma", "Noah", "Amelia", "Oliver")
# ITerate through each name in the vector
for (name in baby_names) {
  # Generate a message using paste0 and print it out
  print(paste0("Hi ", name, "!"))
}
```

## What is happening here?

1.  Store each name in a vector called baby_names so that it can be accessed within the for loop
2.  define a temporary variable that only exists within the context of the for loop: `name`
3.  Create a message using the `paste0` function and print it out for each element.

# Potential Uses

Above is a very simple use of a for loop and it is not particularly useful. It does demonstrate how to iterate through a list which is a very powerful concept.

There are a number of potential applications of this concept:

-   Calculate the mean of each column in a dataset

-   Read and combine a number of spreadsheets

-   Check which rows of a data.frame contain missing values

Imagine a scenario:

You have collected measurement data about iris species and need to report summary statistics on each characteristic of the plants you have measured. However the data is spread across many spreadsheets and you need to somehow amalgamate them to summarise it.

The steps to do this would be:

1.  Get a **list of the paths** to each file we need to read in

```{r}
files <- list.files(path = "data", full.names = TRUE)
head(files)
```

2.  **Use a for loop** to read each file into a list

```{r}
# Make an empty list to collect the data from each spreadsheet
data <- vector(mode = "list", length = length(files))
# Set the iterator to 1. This is an object which will track which iteration the loop is on and will allow us to insert the data into the right part of the list.
i <- 1
# Iterate through the filepaths
for(file in files){
  # Read the data and insert it into the right position of the list
  # data[[i]] selects the position based on what i is set to (in this case numbers 1 to 10)
  data[[i]] <- read.csv(file)
  # increase the iterator
  i <- i + 1
}
# Print out the first dataframe
data[[1]]
```

3.  Now we have a list of data objects, we need to **combine them and calculate summary statistics**.

```{r}
# Load the dplyr package
library(dplyr)

# Bind all the datasets together. Imagine this as stacking the rows of multiple spreadsheets on top of eachother
iris_data <- bind_rows(data)

# Print the data frame
iris_data
```

Now we can calculate summary statistics and make a graph using the dplyr and ggplot pacakges

```{r}
# Group the data by species and calculate the mean value for each statistic
iris_data %>% 
  group_by(Species) %>% 
  summarise(sepal_length = mean(Sepal.Length),
            sepal_width = mean(Sepal.Width), 
            petal_length = mean(Petal.Length), 
            petal_width = mean(Petal.Width))
```

```{r}
library(ggplot2)
iris_data %>% 
  ggplot(aes(x = Petal.Length, y = Petal.Width)) + 
  geom_point(aes(colour = Species))
```

# Alternatives

There are a few alternatives to for loops in R:

## Vectorization

Many calculations are vectorized (they work on the whole vector at once). So instead of:

```{r}
for(name in baby_names){print(paste0("Hi ", name, "!"))}
```

You can do this:

```{r}
print(paste0("Hi ", baby_names, "!"))
```

This is useful but only works with vectors and therefore is limited in scope.

## Mapping Operations

Using a mapping function opens up a world of possibilities. The `purrr` package provides a number of mapping which provide efficient and clean alternatives to for loops.

Instead of using a for loop to read data and summarise it. We can do this:

```{r}
library(purrr)

data <- map(files, read.csv)
bind_rows(data)
```
